{"version":3,"sources":["system_device.js"],"names":["Base","moment","MSystemDevice","DATE_FORMAT","SystemDeviceSummary","signature","COMMAND_ARGUMENT_BY_MONTH","UNIT","MONTH","description","execute","args","options","sumaryAtTime","countType","isArgumentsLegal","warn","sumaryAt","COMMAND_ARGUMENT_BY_UNIT","unix","summarySystemDevice","sumaryAtMoment","isMoment","isValid"],"mappings":"AAAA,OAAOA,IAAP,MAAiB,qBAAjB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,aAAP,MAA0B,mCAA1B;AACA,OAAOC,WAAP,MAAwB,6BAAxB;;AAEA,MAAMC,mBAAN,SAAkCJ,IAAlC,CAAuC;AACjB,aAATK,SAAS,GAAI;AACtB,WAAQ;AACZ;AACA,gCAAgCF,WAAW,CAACG,yBAA0B;AACtE,0BAA0BH,WAAW,CAACI,IAAZ,CAAiBC,KAAM;AACjD,MAJI;AAKD;;AAEqB,aAAXC,WAAW,GAAI;AACxB,WAAO,kBAAP;AACD;AAED;AACF;AACA;AACA;AACA;;;AACe,QAAPC,OAAO,CAAEC,IAAF,EAAQC,OAAR,EAAiB;AAC5B;AACA,QAAI;AAAEC,MAAAA,YAAF;AAAgBC,MAAAA;AAAhB,QAA8BH,IAAlC;;AACA,QAAI,KAAKI,gBAAL,CAAsBJ,IAAtB,EAA4BC,OAA5B,MAAyC,KAA7C,EAAoD;AAClD,WAAKI,IAAL,CAAU,aAAV;AACA,aAAO,KAAP;AACD;;AACD,QAAIC,QAAQ,GAAGhB,MAAM,CAACY,YAAD,EAAeV,WAAW,CAACe,wBAAZ,CAAqCJ,SAArC,CAAf,CAAN,CAAsEK,IAAtE,EAAf;AACAjB,IAAAA,aAAa,CAACkB,mBAAd,CAAkCH,QAAlC;AACD;AAED;AACF;AACA;AACA;AACA;AACA;;;AACEF,EAAAA,gBAAgB,CAAEJ,IAAF,EAAQC,OAAR,EAAiB;AAC/B,QAAI;AAAEC,MAAAA,YAAF;AAAgBC,MAAAA;AAAhB,QAA8BH,IAAlC;AACA,QAAIU,cAAc,GAAGpB,MAAM,CAACY,YAAD,EAAeV,WAAW,CAACe,wBAAZ,CAAqCJ,SAArC,CAAf,CAA3B;;AACA,QACEb,MAAM,CAACqB,QAAP,CAAgBD,cAAhB,MAAoC,KAApC,IACAA,cAAc,CAACE,OAAf,OAA6B,KAD7B,IAEAT,SAAS,KAAKX,WAAW,CAACI,IAAZ,CAAiBC,KAHjC,EAIE;AACA,WAAKQ,IAAL,CAAW,yBAAwBH,YAAa,kBAAiBC,SAAU,EAA3E;AACA,aAAO,KAAP;AACD;;AACD,WAAO,IAAP;AACD;;AA/CoC;;AAkDvC,eAAeV,mBAAf","sourcesContent":["import Base from '~/src/commands/base'\nimport moment from 'moment'\nimport MSystemDevice from '~/src/model/summary/system_device'\nimport DATE_FORMAT from '~/src/constants/date_format'\n\nclass SystemDeviceSummary extends Base {\n  static get signature () {\n    return `\n     Summary:SystemDevice\n     {sumaryAtTime:按月统计浏览器分布情况${DATE_FORMAT.COMMAND_ARGUMENT_BY_MONTH}格式}\n     {countType:日志统计格式, ${DATE_FORMAT.UNIT.MONTH}}\n     `\n  }\n\n  static get description () {\n    return '[按月] 基于数据库统计设备占比'\n  }\n\n  /**\n   * 每天跑一次, 获取项目列表, 遍历t_o_system_collection表\n   * @param {*} args\n   * @param {*} options\n   */\n  async execute (args, options) {\n    // 按月统计, 每天都跑\n    let { sumaryAtTime, countType } = args\n    if (this.isArgumentsLegal(args, options) === false) {\n      this.warn('参数不正确, 自动退出')\n      return false\n    }\n    let sumaryAt = moment(sumaryAtTime, DATE_FORMAT.COMMAND_ARGUMENT_BY_UNIT[countType]).unix()\n    MSystemDevice.summarySystemDevice(sumaryAt)\n  }\n\n  /**\n   * [可覆盖]检查请求参数, 默认检查传入的时间范围是否正确, 如果有自定义需求可以在子类中进行覆盖\n   * @param {*} args\n   * @param {*} options\n   * @return {Boolean}\n   */\n  isArgumentsLegal (args, options) {\n    let { sumaryAtTime, countType } = args\n    let sumaryAtMoment = moment(sumaryAtTime, DATE_FORMAT.COMMAND_ARGUMENT_BY_UNIT[countType])\n    if (\n      moment.isMoment(sumaryAtMoment) === false ||\n      sumaryAtMoment.isValid() === false ||\n      countType !== DATE_FORMAT.UNIT.MONTH\n    ) {\n      this.warn(`参数不正确 sumaryAtTime => ${sumaryAtTime}, countType => ${countType}`)\n      return false\n    }\n    return true\n  }\n}\n\nexport default SystemDeviceSummary\n"],"file":"system_device.js"}