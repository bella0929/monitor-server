{"version":3,"sources":["generate_sql.js"],"names":["Base","moment","_","DATE_FORMAT","SQL_DATE_FORMAT_YM","SINGLE_T_O_PROJECT","SINGLE_T_R_BEHAVIOR_DISTRIBUTION","SINGLE_T_R_DURATION_DISTRIBUTION","SINGLE_T_R_HTTP_ERROR_DISTRIBUTION","SINGLE_T_R_PAGE_VIEW","SINGLE_T_R_SYSTEM_BROWSER","SINGLE_T_R_SYSTEM_DEVICE","SINGLE_T_R_SYSTEM_OS","SINGLE_T_R_SYSTEM_RUNTIME_VERSION","SINGLE_T_R_UNIQUE_VIEW","SINGLE_T_O_ALARM_CONFIG","SINGLE_T_O_USER","SINGLE_T_O_PROJECT_MEMBER","SINGLE_T_O_NEW_USER_SUMMARY","SINGLE_T_R_ALARM_LOG","MUILT_T_O_MONITOR","MUILT_T_O_MONITOR_EXT","MUILT_T_O_UV_RECORD","MUILT_T_R_CITY_DISTRIBUTION","MUILT_T_R_PERFORMANCE","MUILT_T_O_SYSTEM_COLLECTION","MUILT_T_O_USER_FIRST_LOGIN_AT","MUILT_T_R_ERROR_SUMMARY","TABLE_TEMPLATE","generate","baseTableName","projectId","tableTime","content","fininalTableName","GenerateSQL","signature","COMMAND_ARGUMENT_BY_MONTH","description","execute","args","options","projectIdList","startAtYm","finishAtYm","split","isEmpty","warn","commonSqlContent","tableName","finishAtMoment","sqlContent","currentAtMoment","isBefore","clone","add","curremtAtYM","format","insertProjectInfo","log","handle","catch","e","stack","message","console"],"mappings":"AAAA,OAAOA,IAAP,MAAiB,qBAAjB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,CAAP,MAAc,QAAd;AACA,OAAOC,WAAP,MAAwB,6BAAxB;AAEA,MAAMC,kBAAkB,GAAG,QAA3B,C,CAEA;;AACA,MAAMC,kBAAkB,GAAG,aAA3B,C,CAAyC;;AACzC,MAAMC,gCAAgC,GAAG,2BAAzC,C,CAAqE;;AACrE,MAAMC,gCAAgC,GAAG,2BAAzC,C,CAAqE;;AACrE,MAAMC,kCAAkC,GAAG,6BAA3C,C,CAAyE;;AACzE,MAAMC,oBAAoB,GAAG,eAA7B,C,CAA6C;;AAC7C,MAAMC,yBAAyB,GAAG,oBAAlC,C,CAAuD;;AACvD,MAAMC,wBAAwB,GAAG,mBAAjC,C,CAAqD;;AACrD,MAAMC,oBAAoB,GAAG,eAA7B,C,CAA6C;;AAC7C,MAAMC,iCAAiC,GAAG,4BAA1C,C,CAAuE;;AACvE,MAAMC,sBAAsB,GAAG,iBAA/B,C,CAAiD;;AACjD,MAAMC,uBAAuB,GAAG,kBAAhC,C,CAAmD;;AACnD,MAAMC,eAAe,GAAG,UAAxB,C,CAAmC;;AACnC,MAAMC,yBAAyB,GAAG,oBAAlC,C,CAAuD;;AACvD,MAAMC,2BAA2B,GAAG,sBAApC,C,CAA2D;;AAC3D,MAAMC,oBAAoB,GAAG,eAA7B,C,CAA6C;AAE7C;;AACA,MAAMC,iBAAiB,GAAG,aAA1B,C,CAAwC;;AACxC,MAAMC,qBAAqB,GAAG,iBAA9B,C,CAAgD;;AAChD,MAAMC,mBAAmB,GAAG,eAA5B,C,CAA4C;;AAC5C,MAAMC,2BAA2B,GAAG,uBAApC,C,CAA4D;;AAC5D,MAAMC,qBAAqB,GAAG,iBAA9B,C,CAAgD;;AAChD,MAAMC,2BAA2B,GAAG,uBAApC,C,CAA4D;;AAC5D,MAAMC,6BAA6B,GAAG,yBAAtC,C,CAAgE;;AAChE,MAAMC,uBAAuB,GAAG,mBAAhC,C,CAAoD;;AAEpD,IAAIC,cAAc,GAAG,EAArB;AACAA,cAAc,CAACvB,kBAAD,CAAd,GAAsC;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAbA;AAeAuB,cAAc,CAACtB,gCAAD,CAAd,GAAoD;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qEAdA;AAgBAsB,cAAc,CAACrB,gCAAD,CAAd,GAAoD;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2EAZA;AAcAqB,cAAc,CAACpB,kCAAD,CAAd,GAAsD;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uEAhBA;AAkBAoB,cAAc,CAACnB,oBAAD,CAAd,GAAwC;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8DAXA;AAaAmB,cAAc,CAAClB,yBAAD,CAAd,GAA6C;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uEAZA;AAcAkB,cAAc,CAACf,iCAAD,CAAd,GAAqD;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sEAXA;AAaAe,cAAc,CAACjB,wBAAD,CAAd,GAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sEAZA;AAcAiB,cAAc,CAAChB,oBAAD,CAAd,GAAwC;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wEAZA;AAcAgB,cAAc,CAACd,sBAAD,CAAd,GAA0C;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8DAXA;AAaAc,cAAc,CAACR,iBAAD,CAAd,GAAqC;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CArBA;AAsBAQ,cAAc,CAACP,qBAAD,CAAd,GAAyC;AACzC;AACA;AACA;AACA;AACA;AACA;AACA,CAPA;AASAO,cAAc,CAACN,mBAAD,CAAd,GAAuC;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAbA;AAcAM,cAAc,CAACL,2BAAD,CAAd,GAA+C;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA,CAPA;AASAK,cAAc,CAACJ,qBAAD,CAAd,GAAyC;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAfA;AAiBAI,cAAc,CAACH,2BAAD,CAAd,GAA+C;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAtBA;AAuBAG,cAAc,CAACF,6BAAD,CAAd,GAAiD;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAfA;AAgBAE,cAAc,CAACD,uBAAD,CAAd,GAA2C;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAdA;AAeAC,cAAc,CAACT,oBAAD,CAAd,GAAwC;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAbA;AAcA;;AACAS,cAAc,CAACb,uBAAD,CAAd,GAA2C;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAlBA;AAmBAa,cAAc,CAACZ,eAAD,CAAd,GAAmC;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAlBA;AAmBAY,cAAc,CAACX,yBAAD,CAAd,GAA6C;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAbA;AAcAW,cAAc,CAACV,2BAAD,CAAd,GAA+C;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA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","sourcesContent":["import Base from '~/src/commands/base'\nimport moment from 'moment'\nimport _ from 'lodash'\nimport DATE_FORMAT from '~/src/constants/date_format'\n\nconst SQL_DATE_FORMAT_YM = 'YYYYMM'\n\n// 不需要分表\nconst SINGLE_T_O_PROJECT = 't_o_project' //  项目表\nconst SINGLE_T_R_BEHAVIOR_DISTRIBUTION = 't_r_behavior_distribution' //  用户点击记录表\nconst SINGLE_T_R_DURATION_DISTRIBUTION = 't_r_duration_distribution' // 用户停留时长分布表\nconst SINGLE_T_R_HTTP_ERROR_DISTRIBUTION = 't_r_http_error_distribution' // 错误分布表\nconst SINGLE_T_R_PAGE_VIEW = 't_r_page_view' //  pv 表\nconst SINGLE_T_R_SYSTEM_BROWSER = 't_r_system_browser' //  浏览器分布表\nconst SINGLE_T_R_SYSTEM_DEVICE = 't_r_system_device' // 设备分布表\nconst SINGLE_T_R_SYSTEM_OS = 't_r_system_os' //  操作系统分布表\nconst SINGLE_T_R_SYSTEM_RUNTIME_VERSION = 't_r_system_runtime_version' // 项目版本表\nconst SINGLE_T_R_UNIQUE_VIEW = 't_r_unique_view' //  uv表\nconst SINGLE_T_O_ALARM_CONFIG = 't_o_alarm_config' // 项目配置表\nconst SINGLE_T_O_USER = 't_o_user' // 用户表\nconst SINGLE_T_O_PROJECT_MEMBER = 't_o_project_member' // 项目成员表\nconst SINGLE_T_O_NEW_USER_SUMMARY = 't_r_new_user_summary' // 新用户统计表\nconst SINGLE_T_R_ALARM_LOG = 't_r_alarm_log' // 报警记录表\n\n// 需要分表\nconst MUILT_T_O_MONITOR = 't_o_monitor' //  异常数据表, 按项目按月分表, 只有最基础的错误信息, ext字段需要到详情表中单独获取, 命名规则: t_o_monitor_项目id_YYYYMM\nconst MUILT_T_O_MONITOR_EXT = 't_o_monitor_ext' // 异常数据的ext信息, 按项目按月分表, 命名规则: t_o_monitor_ext_项目id_YYYYMM\nconst MUILT_T_O_UV_RECORD = 't_o_uv_record' // uv记录表, 按项目&月分表,最小统计粒度为小时 命名规则: t_o_uv_record_项目id_YYYYMM\nconst MUILT_T_R_CITY_DISTRIBUTION = 't_r_city_distribution' // 城市数据的扩展信息, 按项目按月分表, 命名规则: t_r_city_distribution_项目id_YYYYMM, 获取数据时, 以记录创建时间和记录所属项目id, 决定distribute记录所在表\nconst MUILT_T_R_PERFORMANCE = 't_r_performance' // 性能指标表, 按项目按月分表, 命名规则: t_r_performance_项目id_YYYYMM, 获取数据时, 以记录创建时间和记录所属项目id, 决定distribute记录所在表\nconst MUILT_T_O_SYSTEM_COLLECTION = 't_o_system_collection' // 设备记录表, 按项目分表, 最小统计粒度为月, 命名规则: t_o_device_info_项目id\nconst MUILT_T_O_USER_FIRST_LOGIN_AT = 't_o_user_first_login_at' // 用户首次登陆表, 用于统计新课, 按项目分表, 命名规则: t_o_customer_first_login_at_项目id\nconst MUILT_T_R_ERROR_SUMMARY = 't_r_error_summary' // 错误统计表,用于统计错误类型，错误名字\n\nlet TABLE_TEMPLATE = {}\nTABLE_TEMPLATE[SINGLE_T_O_PROJECT] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '项目id',\n  \\`display_name\\` varchar(50) NOT NULL DEFAULT '' COMMENT '项目名称',\n  \\`project_name\\` varchar(50) NOT NULL DEFAULT '' COMMENT '项目代号(替代项目id, 方便debug)',\n  \\`c_desc\\` varchar(100) NOT NULL DEFAULT '' COMMENT '备注信息',\n  \\`rate\\` int(10) NOT NULL DEFAULT '10000' COMMENT '数据抽样比率',\n  \\`is_delete\\` tinyint(1) NOT NULL DEFAULT '0' COMMENT '是否已删除(1 => 是, 0 => 否)',\n  \\`create_ucid\\` varchar(20) NOT NULL DEFAULT '' COMMENT '创建人ucid',\n  \\`update_ucid\\` varchar(20) NOT NULL DEFAULT '' COMMENT '更新人ucid',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  UNIQUE KEY \\`uniq_project_name\\` (\\`project_name\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='项目表';`\n\nTABLE_TEMPLATE[SINGLE_T_R_BEHAVIOR_DISTRIBUTION] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`code\\` varchar(50) NOT NULL DEFAULT '' COMMENT '用户行为标识',\n  \\`name\\` varchar(50) NOT NULL DEFAULT '' COMMENT '用户点击名称',\n  \\`url\\` varchar(200) NOT NULL DEFAULT '' COMMENT '用户点击页面',\n  \\`total_count\\` int(10) NOT NULL DEFAULT '0' COMMENT '点击总量',\n  \\`count_at_time\\` varchar(30) NOT NULL DEFAULT '' COMMENT '统计日期,格式根据统计尺度不同有三种可能,  hour => YYYY-MM-DD_HH, day => YYYY-MM-DD, month => YYYY-MM',\n  \\`count_type\\` varchar(20) NOT NULL DEFAULT 'day' COMMENT '统计尺度(hour/day/month)',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布详情记录id',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  KEY \\`idx_project_id_count_type_count_at_time\\` (\\`project_id\\`, \\`count_type\\`, \\`count_at_time\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户点击记录表, 最小统计粒度为天';`\n\nTABLE_TEMPLATE[SINGLE_T_R_DURATION_DISTRIBUTION] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`total_stay_ms\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '总停留毫秒数',\n  \\`total_uv\\` int(10) NOT NULL DEFAULT '0' COMMENT '总uv数(从uv表中获取)',\n  \\`count_at_time\\` varchar(30) NOT NULL DEFAULT '' COMMENT '统计日期,格式根据统计尺度不同有两种可能, day => YYYY-MM-DD, month => YYYY-MM',\n  \\`count_type\\` varchar(20) NOT NULL DEFAULT 'day' COMMENT '统计尺度(day/month)',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布详情记录id',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  PRIMARY KEY (\\`id\\`),\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  KEY \\`idx_project_id_count_type_count_at_time\\` (\\`project_id\\`, \\`count_type\\`, \\`count_at_time\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户停留时长分布, 不分表，按天和按月进行统计';`\n\nTABLE_TEMPLATE[SINGLE_T_R_HTTP_ERROR_DISTRIBUTION] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`total_count\\` int(10) NOT NULL DEFAULT '0' COMMENT 'http响应码总数',\n  \\`http_code_2xx_count\\` int(10) NOT NULL DEFAULT '0' COMMENT 'http响应码2xx总数',\n  \\`http_code_3xx_count\\` int(10) NOT NULL DEFAULT '0' COMMENT 'http响应码3xx总数',\n  \\`http_code_4xx_count\\` int(10) NOT NULL DEFAULT '0' COMMENT 'http响应码4xx总数',\n  \\`http_code_5xx_count\\` int(10) NOT NULL DEFAULT '0' COMMENT 'http响应码5xx总数',\n  \\`http_code_other_count\\` int(10) NOT NULL DEFAULT '0' COMMENT '其他http响应码总数',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布详情记录id',\n  \\`count_at_time\\` varchar(30) NOT NULL DEFAULT '' COMMENT '统计日期,格式根据统计尺度不同有三种可能,  hour => YYYY-MM-DD_HH, day => YYYY-MM-DD, month => YYYY-MM',\n  \\`count_type\\` varchar(20) NOT NULL DEFAULT 'hour' COMMENT '统计尺度(hour/day/month)',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  PRIMARY KEY (\\`id\\`),\n  KEY \\`idx_project_id_count_type_count_at_time\\` (\\`project_id\\`, \\`count_type\\`, \\`count_at_time\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='错误分布, 不分表，按天和按月进行统计';`\n\nTABLE_TEMPLATE[SINGLE_T_R_PAGE_VIEW] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`total_count\\` int(10) NOT NULL DEFAULT '0' COMMENT 'pv数',\n  \\`count_at_time\\` varchar(30) NOT NULL DEFAULT '' COMMENT '统计日期,格式根据统计尺度不同有三种可能,  hour => YYYY-MM-DD_HH, day => YYYY-MM-DD, month => YYYY-MM',\n  \\`count_type\\` varchar(20) NOT NULL DEFAULT 'hour' COMMENT '统计尺度(hour/day/month)',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布记录id',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  UNIQUE KEY \\`uniq_project_id_count_type_count_at_time\\` (\\`project_id\\`,\\`count_type\\`,\\`count_at_time\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='pv记录表, 不分表';`\n\nTABLE_TEMPLATE[SINGLE_T_R_SYSTEM_BROWSER] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`browser\\` varchar(20) NOT NULL DEFAULT '' COMMENT '浏览器品牌',\n  \\`browser_version\\` varchar(50) NOT NULL DEFAULT '' COMMENT '浏览器详情',\n  \\`total_count\\` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '数量总和',\n  \\`count_at_month\\` varchar(15) NOT NULL DEFAULT '' COMMENT '统计时间段, YYYY-MM格式 => 2018-09',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布记录id',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  KEY \\`idx_project_id_count_at_month\\` (\\`project_id\\`, \\`count_at_month\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='浏览器分布数据表, 不分表, 按月统计';`\n\nTABLE_TEMPLATE[SINGLE_T_R_SYSTEM_RUNTIME_VERSION] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`runtime_version\\` varchar(50) NOT NULL DEFAULT '' COMMENT '应用版本号',\n  \\`total_count\\` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '数量总和',\n  \\`count_at_month\\` varchar(15) NOT NULL DEFAULT '' COMMENT '统计时间段, YYYY-MM格式 => 2018-09',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布记录id',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  KEY \\`idx_project_id_count_at_month\\` (\\`project_id\\`, \\`count_at_month\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='版本分布数据表, 不分表, 按月统计';`\n\nTABLE_TEMPLATE[SINGLE_T_R_SYSTEM_DEVICE] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`device_vendor\\` varchar(50) NOT NULL DEFAULT '' COMMENT '设备制造商',\n  \\`device_model\\` varchar(50) NOT NULL DEFAULT '' COMMENT '设备详情',\n  \\`total_count\\` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '数量总和',\n  \\`count_at_month\\` varchar(15) NOT NULL DEFAULT '' COMMENT '统计时间段, YYYY-MM格式 => 2018-09',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布记录id',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  KEY \\`idx_project_id_count_at_month\\` (\\`project_id\\`, \\`count_at_month\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='设备分布数据表, 不分表, 按月统计';`\n\nTABLE_TEMPLATE[SINGLE_T_R_SYSTEM_OS] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`os\\` varchar(50) NOT NULL DEFAULT '' COMMENT '操作系统名',\n  \\`os_version\\` varchar(50) NOT NULL DEFAULT '' COMMENT '操作系统版本',\n  \\`total_count\\` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '数量总和',\n  \\`count_at_month\\` varchar(15) NOT NULL DEFAULT '' COMMENT '统计时间段, YYYY-MM格式 => 2018-09',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布记录id',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  KEY \\`idx_project_id_count_at_month\\` (\\`project_id\\`, \\`count_at_month\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='操作系统分布数据表, 不分表, 按月统计';`\n\nTABLE_TEMPLATE[SINGLE_T_R_UNIQUE_VIEW] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`total_count\\` int(10) NOT NULL DEFAULT '0' COMMENT 'uv数',\n  \\`count_at_time\\` varchar(30) NOT NULL DEFAULT '' COMMENT '统计日期,格式根据统计尺度不同有三种可能,  hour => YYYY-MM-DD_HH, day => YYYY-MM-DD, month => YYYY-MM',\n  \\`count_type\\` varchar(20) NOT NULL DEFAULT 'hour' COMMENT '统计尺度(hour/day/month)',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布记录id',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  UNIQUE KEY \\`uniq_project_id_count_type_count_at_time\\` (\\`project_id\\`,\\`count_type\\`,\\`count_at_time\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='uv记录表, 不分表';`\n\nTABLE_TEMPLATE[MUILT_T_O_MONITOR] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`error_type\\` varchar(20) NOT NULL DEFAULT '' COMMENT '异常类型(目前是四种,分别对应前端的四种报错类型: api_data =>前端数据结构报警, start_process => 启动过程异常, load_wv => Url加载空服务报警, api_code => 请求接口异常报警)',\n  \\`error_name\\` varchar(255) NOT NULL DEFAULT '' COMMENT '错误名/错误代码,用于细分错误类别',\n  \\`http_code\\` int(10) NOT NULL DEFAULT '0' COMMENT 'http状态码, 没有则为0',\n  \\`monitor_ext_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '详情id',\n  \\`during_ms\\` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '接口请求时长, 单位毫秒',\n  \\`request_size_b\\` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '接口请求体积, 单位b',\n  \\`response_size_b\\` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '接口响应体积, 单位b',\n  \\`url\\` varchar(255) NOT NULL DEFAULT '' COMMENT '发生异常的url',\n  \\`country\\` varchar(10) NOT NULL DEFAULT '' COMMENT '所属国家',\n  \\`province\\` varchar(15) NOT NULL DEFAULT '' COMMENT '所属省份',\n  \\`city\\` varchar(15) NOT NULL DEFAULT '' COMMENT '所属城市',\n  \\`log_at\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '日志记录时间',\n  \\`md5\\` char(32) NOT NULL DEFAULT '' COMMENT '记录生成MD5',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  UNIQUE KEY \\`uniq_log_at_md5\\` (\\`log_at\\`,\\`md5\\`),\n  KEY \\`idx_log_at_error_type_error_name_url\\` (\\`log_at\\`,\\`error_type\\`,\\`error_name\\`,\\`url\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='异常数据表, 按项目按月分表, 只有最基础的错误信息, ext字段需要到详情表中单独获取, 命名规则: t_o_monitor_项目id_YYYYMM';\n`\nTABLE_TEMPLATE[MUILT_T_O_MONITOR_EXT] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`ext_json\\` text COMMENT '异常记录扩展信息',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='异常数据的ext信息, 按项目按月分表, 命名规则: t_o_monitor_ext_项目id_YYYYMM';\n`\n\nTABLE_TEMPLATE[MUILT_T_O_UV_RECORD] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '项目id',\n  \\`uuid\\` varchar(50) NOT NULL DEFAULT '' COMMENT '设备唯一标识',\n  \\`country\\` varchar(10) NOT NULL DEFAULT '' COMMENT '所属国家',\n  \\`province\\` varchar(15) NOT NULL DEFAULT '' COMMENT '所属省份',\n  \\`city\\` varchar(15) NOT NULL DEFAULT '' COMMENT '所属城市',\n  \\`visit_at_hour\\` varchar(20) NOT NULL DEFAULT '' COMMENT '访问日期, 数据格式为 YYYY-MM-DD_HH demo => 2018-08-02_23',\n  \\`pv_count\\` int(10) NOT NULL DEFAULT '0' COMMENT '时间段内同一uuid访问次数, 用于计算总pv',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  UNIQUE KEY \\`uniq_visit_at_hour_uuid\\` (\\`visit_at_hour\\`,\\`uuid\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='uv记录表, 按项目&月分表,最小统计粒度为小时 命名规则: t_o_uv_record_项目id_YYYYMM';\n        `\nTABLE_TEMPLATE[MUILT_T_R_CITY_DISTRIBUTION] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`city_distribute_json\\` text COMMENT '扩展字段',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='城市数据的扩展信息, 按项目按月分表, 命名规则: t_r_city_distribution_项目id_YYYYMM, 获取数据时, 以记录创建时间和记录所属项目id, 决定distribute记录所在表';\n`\n\nTABLE_TEMPLATE[MUILT_T_R_PERFORMANCE] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`sum_indicator_value\\` bigInt(10) NOT NULL DEFAULT '0' COMMENT '性能指标求和',\n  \\`pv\\` bigInt(10) NOT NULL DEFAULT '0' COMMENT '性能指标pv数,用于计算平均时长',\n  \\`indicator\\` varchar(50) NOT NULL DEFAULT '' COMMENT '性能指标:DNS响应时间/TCP时间/404数量/etc',\n  \\`url\\` varchar(255) NOT NULL DEFAULT '' COMMENT '页面url',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布详情记录id',\n  \\`count_at_time\\` varchar(20) NOT NULL DEFAULT '' COMMENT '统计日期,格式根据统计尺度不同有四种可能,  minute => YYYY-MM-DD_HH:mm, hour => YYYY-MM-DD_HH, day => YYYY-MM-DD, month => YYYY-MM',\n  \\`count_type\\` varchar(10) NOT NULL DEFAULT 'minute' COMMENT '统计尺度(minute/hour/day/month)',\n\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '更新时间',\n  PRIMARY KEY (\\`id\\`),\n  KEY \\`idx_count_at_time_count_type_url_indicator\\` (\\`count_at_time\\`, \\`count_type\\`, \\`url\\`, \\`indicator\\`)\n  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='性能指标表, 按项目按月分表, 索引应为唯一索引, 但是长度超限, 因此只能使用index';\n  `\n\nTABLE_TEMPLATE[MUILT_T_O_SYSTEM_COLLECTION] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`uuid\\` varchar(50) NOT NULL DEFAULT '' COMMENT '设备唯一标识',\n  \\`browser\\` varchar(50) NOT NULL DEFAULT '' COMMENT '浏览器品牌',\n  \\`browser_version\\` varchar(100) NOT NULL DEFAULT '' COMMENT '浏览器版本详情',\n  \\`engine\\` varchar(100) NOT NULL DEFAULT '' COMMENT '内核名称',\n  \\`engine_version\\` varchar(100) NOT NULL DEFAULT '' COMMENT '内核版本详情',\n  \\`device_vendor\\` varchar(100) NOT NULL DEFAULT '' COMMENT '手机品牌',\n  \\`device_model\\` varchar(100) NOT NULL DEFAULT '' COMMENT '手机型号',\n  \\`os\\` varchar(50) NOT NULL DEFAULT '' COMMENT '操作系统',\n  \\`os_version\\` varchar(50) NOT NULL DEFAULT '' COMMENT '操作系统详情',\n  \\`country\\` varchar(10) NOT NULL DEFAULT '' COMMENT '所属国家',\n  \\`province\\` varchar(15) NOT NULL DEFAULT '' COMMENT '所属省份',\n  \\`city\\` varchar(15) NOT NULL DEFAULT '' COMMENT '所属城市',\n  \\`runtime_version\\` varchar(50) NOT NULL DEFAULT '' COMMENT '应用版本',\n  \\`visit_at_month\\` varchar(20) NOT NULL DEFAULT '' COMMENT '访问日期, 数据格式为 YYYY-MM demo => 2018-09',\n  \\`log_at\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '日志记录时间',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  UNIQUE KEY \\`uniq_visit_at_month_uuid\\` (\\`visit_at_month\\`,\\`uuid\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='设备记录表, 按项目分表, 最小统计粒度为月, 命名规则: t_o_device_info_项目id';\n`\nTABLE_TEMPLATE[MUILT_T_O_USER_FIRST_LOGIN_AT] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`ucid\\` varchar(20) NOT NULL DEFAULT '' COMMENT '用户id',\n  \\`first_visit_at\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '用户首次访问时间',\n\n  \\`country\\` varchar(10) NOT NULL DEFAULT '' COMMENT '所属国家',\n  \\`province\\` varchar(15) NOT NULL DEFAULT '' COMMENT '所属省份',\n  \\`city\\` varchar(15) NOT NULL DEFAULT '' COMMENT '所属城市',\n\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '更新时间',\n  PRIMARY KEY (\\`id\\`),\n  UNIQUE KEY \\`uniq_ucid\\` (\\`ucid\\`),\n  INDEX \\`idx_first_visit_at\\` (\\`first_visit_at\\`)\n  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='新用户记录表, 按项目分表, 命名规则: t_o_customer_first_login_at_项目id';\n`\nTABLE_TEMPLATE[MUILT_T_R_ERROR_SUMMARY] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`error_type\\` varchar(20) NOT NULL DEFAULT '' COMMENT '错误类型',\n  \\`error_name\\` varchar(255) NOT NULL DEFAULT '' COMMENT '错误名字',\n  \\`url_path\\` varchar(255) NOT NULL DEFAULT '' COMMENT '错误URL_PATH',\n  \\`city_distribution_id\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '城市分布详情id',\n  \\`count_at_time\\` varchar(20) NOT NULL DEFAULT '' COMMENT '统计时间(按类型不同,day:YYYY-MM-DD;hour:YYYY-MM-DD_HH;minute:YYYY-MM-DD_HH:mm)',\n  \\`count_type\\` varchar(10) NOT NULL DEFAULT 'day' COMMENT '统计类型(day天,hour小时,minute分)',\n  \\`error_count\\` int(10) NOT NULL DEFAULT '0' COMMENT '数量总和',\n  \\`create_time\\` int(20) NOT NULL DEFAULT '0' COMMENT '创建时间',\n  \\`update_time\\` int(20) NOT NULL DEFAULT '0' COMMENT '更新时间',\n  PRIMARY KEY (\\`id\\`),\n  KEY \\`idx_count_at_time_count_type_error_type_error_name\\` (\\`count_at_time\\`,\\`count_type\\`,\\`error_type\\`,\\`error_name\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='按项目,按月统计error错误';\n`\nTABLE_TEMPLATE[SINGLE_T_R_ALARM_LOG] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '要报警项目id',\n  \\`config_id\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '报警配置id',\n  \\`send_at\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '报警时间戳',\n  \\`error_type\\` varchar(20) NOT NULL DEFAULT '' COMMENT '错误类型',\n  \\`error_name\\` varchar(255) NOT NULL DEFAULT '' COMMENT '错误名字',\n  \\`message\\` varchar(500) NOT NULL DEFAULT '' COMMENT '报警信息',\n  \\`create_time\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '创建时间',\n  \\`update_time\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '更新时间',\n  PRIMARY KEY (\\`id\\`),\n  KEY \\`idx_send_at_project_id\\` (\\`send_at\\`,\\`project_id\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n`\n/** ************************** MULTI & SINGLE ******************************************/\nTABLE_TEMPLATE[SINGLE_T_O_ALARM_CONFIG] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT,\n  \\`project_id\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '要报警项目id',\n  \\`owner_ucid\\` varchar(20) NOT NULL DEFAULT '' COMMENT '项目所有人id',\n  \\`error_type\\` varchar(20) NOT NULL DEFAULT '' COMMENT '报警错误类型',\n  \\`error_name\\` varchar(255) NOT NULL DEFAULT '' COMMENT '要报警错误名字',\n  \\`time_range_s\\` int(20) unsigned NOT NULL DEFAULT '0' COMMENT '报警时间范围_秒',\n  \\`max_error_count\\` int(20) unsigned NOT NULL DEFAULT '0' COMMENT '报警错误数阈值',\n  \\`alarm_interval_s\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '报警时间间隔_秒',\n  \\`is_enable\\` tinyint(1) unsigned NOT NULL DEFAULT '1' COMMENT '是否开启本条报警配置1：是0：否',\n  \\`note\\` varchar(255) NOT NULL DEFAULT '' COMMENT '配置说明',\n  \\`is_delete\\` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '是否删除(1 => 是, 0 => 否)',\n  \\`create_ucid\\` varchar(20) NOT NULL DEFAULT '' COMMENT '创建此记录的人',\n  \\`update_ucid\\` varchar(20) NOT NULL DEFAULT '' COMMENT '更新此记录的人',\n  \\`create_time\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '创建此记录的时间',\n  \\`update_time\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '更新此记录的时间',\n  PRIMARY KEY (\\`id\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='项目报警配置表';\n`\nTABLE_TEMPLATE[SINGLE_T_O_USER] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`ucid\\` varchar(50) NOT NULL DEFAULT '' COMMENT '贝壳ucid',\n  \\`account\\` varchar(50) NOT NULL DEFAULT '' COMMENT '账户名,不能重复',\n  \\`email\\` varchar(50) NOT NULL DEFAULT '' COMMENT '邮箱',\n  \\`password_md5\\` varchar(32) NOT NULL DEFAULT '' COMMENT 'md5后的password',\n  \\`nickname\\` varchar(20) NOT NULL DEFAULT '' COMMENT '昵称',\n  \\`role\\` varchar(50) NOT NULL DEFAULT 'dev' COMMENT '角色(dev => 开发者,admin => 管理员)',\n  \\`register_type\\` varchar(20) NOT NULL DEFAULT 'site' COMMENT '注册类型(site => 网站注册, third => 第三方登录)',\n  \\`avatar_url\\` varchar(200) NOT NULL DEFAULT 'http://ww1.sinaimg.cn/large/00749HCsly1fwofq2t1kaj30qn0qnaai.jpg' COMMENT '头像地址, 默认使用贝壳logo',\n  \\`mobile\\` varchar(20) NOT NULL DEFAULT '' COMMENT '手机号',\n  \\`is_delete\\` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '是否删除(1 => 是, 0 => 否)',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  UNIQUE KEY \\`uniq_ucid\\` (\\`ucid\\`),\n  UNIQUE KEY \\`uniq_account\\` (\\`account\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户信息表';\n`\nTABLE_TEMPLATE[SINGLE_T_O_PROJECT_MEMBER] = `(\n    \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT,\n    \\`project_id\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '项目id',\n    \\`ucid\\` varchar(20) NOT NULL DEFAULT '' COMMENT '项目参与者ucid',\n    \\`role\\` varchar(20) NOT NULL DEFAULT '' COMMENT '参与者角色(owner => 组长, dev => 成员)',\n    \\`need_alarm\\` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '是否需要报警(0 => 不需要, 1 => 需要)',\n    \\`is_delete\\` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '是否已删除(0 => 未删除, 1 => 已删除)',\n    \\`create_ucid\\` varchar(20) NOT NULL DEFAULT '' COMMENT '创建者ucid',\n    \\`update_ucid\\` varchar(20) NOT NULL DEFAULT '' COMMENT '更新者ucid',\n    \\`create_time\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '创建此记录的时间',\n    \\`update_time\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '更新此记录的时间',\n    PRIMARY KEY (\\`id\\`)\n  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='项目成员表';\n`\nTABLE_TEMPLATE[SINGLE_T_O_NEW_USER_SUMMARY] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`total_count\\` int(10)    NOT NULL DEFAULT '0' COMMENT '数量总和',\n  \\`count_at_time\\` varchar(20) NOT NULL DEFAULT '' COMMENT '统计日期,格式根据统计尺度不同三两种可能, hour => YYYY-MM-DD_HH, day => YYYY-MM-DD, month => YYYY-MM',\n  \\`count_type\\` varchar(10) NOT NULL DEFAULT 'day' COMMENT '统计尺度(hour/day/month)',\n  \n  \\`city_distribute_id\\` bigint(10) NOT NULL DEFAULT 0 COMMENT '城市分布详情记录id',\n  \n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '更新时间',\n  PRIMARY KEY (\\`id\\`),\n  INDEX \\`idx_count_at_time_project_id\\` (\\`count_at_time\\`, \\`project_id\\`)\n  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='新用户统计表, 不分表';\n`\n\nfunction generate (baseTableName, projectId = '', tableTime = '') {\n  // 获取模板\n  let content = TABLE_TEMPLATE[baseTableName]\n\n  // 生成表名\n  let fininalTableName = `${baseTableName}`\n  switch (baseTableName) {\n    case MUILT_T_O_MONITOR:\n      fininalTableName = `${fininalTableName}_${projectId}_${tableTime}`\n      break\n    case MUILT_T_O_MONITOR_EXT:\n      fininalTableName = `${fininalTableName}_${projectId}_${tableTime}`\n      break\n    case MUILT_T_O_UV_RECORD:\n      fininalTableName = `${fininalTableName}_${projectId}_${tableTime}`\n      break\n    case MUILT_T_R_CITY_DISTRIBUTION:\n      fininalTableName = `${fininalTableName}_${projectId}_${tableTime}`\n      break\n    case MUILT_T_R_PERFORMANCE:\n      fininalTableName = `${fininalTableName}_${projectId}_${tableTime}`\n      break\n    case MUILT_T_O_SYSTEM_COLLECTION:\n      fininalTableName = `${fininalTableName}_${projectId}`\n      break\n    case MUILT_T_O_USER_FIRST_LOGIN_AT:\n      fininalTableName = `${fininalTableName}_${projectId}`\n      break\n    case MUILT_T_R_ERROR_SUMMARY:\n      fininalTableName = `${fininalTableName}_${projectId}_${tableTime}`\n      break\n    default:\n  }\n\n  return `\nCREATE TABLE  IF NOT EXISTS  \\`${fininalTableName}\\` ${content}\n    `\n}\n\nclass GenerateSQL extends Base {\n  static get signature () {\n    return `\n       Utils:GenerateSQL\n       {projectIdList:项目id列表,逗号分割}\n       {startAtYm:建表日期开始时间(包括该时间),${DATE_FORMAT.COMMAND_ARGUMENT_BY_MONTH}格式}\n       {finishAtYm:建表日期结束时间(包括该时间),${DATE_FORMAT.COMMAND_ARGUMENT_BY_MONTH}格式}\n       `\n  }\n\n  static get description () {\n    return '生成项目在指定日期范围内的建表SQL'\n  }\n\n  async execute (args, options) {\n    let { projectIdList, startAtYm, finishAtYm } = args\n    projectIdList = projectIdList.split(',')\n    if (_.isEmpty(projectIdList)) {\n      this.warn('自动退出:projectIdList为空 =>', projectIdList)\n      return false\n    }\n    let commonSqlContent = `\n\n\n-- Adminer 4.3.1 MySQL dump\n-- 时间类型只有以下模式\n--\n-- year => YYYY\n-- month => YYYY-MM\n-- day => YYYY-MM-DD\n-- hour => YYYY-MM-DD_HH\n-- minute => YYYY-MM-DD_HH:mm\n-- second => YYYY-MM-DD_HH:mm:ss\n-- \n-- 字段规范\n-- 使用下划线区分\n-- 数字默认值一般为0\n-- 字符串默认值一般为空字符串\n-- 数据库关键字/可能为关键字的字段前, 加c_前缀\n-- url => varchar(255)\n-- id => bigint(20)\n-- 时间戳 => bigint(20)\n-- create_time => bigint(20) 数据库中记录创建的时间\n-- update_time => bigint(20) 数据库中记录更新的时间\n-- count_at_time => varchar(30)  文字型时间, 格式根据count_type而定\n-- count_type => varchar(20)  时间格式(year/month/day/hour/minute/second)\n-- url => varchar(255)\n-- url => varchar(255)\n-- url => varchar(255)\n\nSET NAMES utf8mb4;\nSET foreign_key_checks = 0;\n\n\n`\n    for (let tableName of [\n      SINGLE_T_O_PROJECT,\n      SINGLE_T_R_BEHAVIOR_DISTRIBUTION,\n      SINGLE_T_R_DURATION_DISTRIBUTION,\n      SINGLE_T_R_HTTP_ERROR_DISTRIBUTION,\n      SINGLE_T_R_PAGE_VIEW,\n      SINGLE_T_R_SYSTEM_BROWSER,\n      SINGLE_T_R_SYSTEM_RUNTIME_VERSION,\n      SINGLE_T_R_SYSTEM_DEVICE,\n      SINGLE_T_R_SYSTEM_OS,\n      SINGLE_T_R_UNIQUE_VIEW,\n      SINGLE_T_O_ALARM_CONFIG,\n      SINGLE_T_O_USER,\n      SINGLE_T_O_PROJECT_MEMBER,\n      SINGLE_T_O_NEW_USER_SUMMARY,\n      SINGLE_T_R_ALARM_LOG\n    ]) {\n      let content = generate(tableName)\n      commonSqlContent = `${commonSqlContent}\\n${content}`\n    }\n    let finishAtMoment = moment(finishAtYm, DATE_FORMAT.COMMAND_ARGUMENT_BY_MONTH)\n    let sqlContent = '-- --------分表部分---------'\n    for (let projectId of projectIdList) {\n      for (let currentAtMoment = moment(startAtYm, DATE_FORMAT.COMMAND_ARGUMENT_BY_MONTH);\n        // 生成时间范围之内的数据表\n        currentAtMoment.isBefore(finishAtMoment.clone().add(1, 'months'));\n        currentAtMoment = currentAtMoment.clone().add(1, 'months')) {\n        let curremtAtYM = currentAtMoment.format(SQL_DATE_FORMAT_YM)\n        sqlContent = `${sqlContent}\\n-- SQL for ${curremtAtYM} => \\n`\n        for (let tableName of [\n          MUILT_T_O_MONITOR,\n          MUILT_T_O_MONITOR_EXT,\n          MUILT_T_O_UV_RECORD,\n          MUILT_T_R_CITY_DISTRIBUTION,\n          MUILT_T_R_PERFORMANCE,\n          MUILT_T_O_SYSTEM_COLLECTION,\n          MUILT_T_O_USER_FIRST_LOGIN_AT,\n          MUILT_T_R_ERROR_SUMMARY\n        ]) {\n          let content = generate(tableName, projectId, curremtAtYM)\n          sqlContent = `${sqlContent}\\n${content}`\n        }\n      }\n    }\n\n    let insertProjectInfo = ``\n\n    this.log(`${commonSqlContent}\\n${sqlContent}\\n${insertProjectInfo}\\n`)\n  }\n\n  /**\n   * 覆盖父类方法, 避免再手工删除冗余日志记录\n   * @param {*} args\n   * @param {*} options\n   */\n  async handle (args, options) {\n    await this.execute(args, options).catch(e => {\n      this.log('catch error')\n      this.log(e.stack)\n    })\n  }\n\n  /**\n   * 覆盖父类方法, 避免再手工删除冗余日志记录\n   * @param {*} args\n   * @param {*} options\n   */\n  async log (message) {\n    console.log(message)\n  }\n}\n\nexport default GenerateSQL\n"],"file":"generate_sql.js"}