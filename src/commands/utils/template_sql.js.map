{"version":3,"sources":["template_sql.js"],"names":["Base","moment","DATE_FORMAT","MPerformance","Knex","SQL_DATE_FORMAT_YM","SINGLE_T_O_PROJECT","SINGLE_T_R_BEHAVIOR_DISTRIBUTION","SINGLE_T_R_DURATION_DISTRIBUTION","SINGLE_T_R_HTTP_ERROR_DISTRIBUTION","SINGLE_T_R_PAGE_VIEW","SINGLE_T_R_SYSTEM_BROWSER","SINGLE_T_R_SYSTEM_DEVICE","SINGLE_T_R_SYSTEM_OS","SINGLE_T_R_SYSTEM_RUNTIME_VERSION","SINGLE_T_R_UNIQUE_VIEW","SINGLE_T_O_ALARM_CONFIG","SINGLE_T_O_USER","SINGLE_T_O_PROJECT_MEMBER","SINGLE_T_O_NEW_USER_SUMMARY","SINGLE_T_R_ALARM_LOG","MUILT_T_O_MONITOR","MUILT_T_O_MONITOR_EXT","MUILT_T_O_UV_RECORD","MUILT_T_R_CITY_DISTRIBUTION","MUILT_T_R_PERFORMANCE","MUILT_T_O_SYSTEM_COLLECTION","MUILT_T_O_USER_FIRST_LOGIN_AT","MUILT_T_R_ERROR_SUMMARY","urlList","errorNameList","getSQL","sql","sqlList","getAlarmLog","getUserSQL","getBehaviorDistribution","getErrorSummarySQL","getOriginMonitorSQL","getIndicatorSQl","getOSDistribution","getBrowserDistribution","getDuration","getNewUser","schema","raw","join","id","timeAt","startOf","unix","count","index","errorName","slice","length","hour","endOf","format","stay","browserList","versions","month","browser","version","systemList","system","indicatorList","INDICATOR_TYPE_LIST","nowMoment","tableName","clone","subtract","startDayMoment","logAt","nowDay","date","threeDayAgo","code","name","day","toString","padStart","monthPrefix","timeStrPrefix","nowHour","endHour","hourStr","minute","minuteStr","TABLE_TEMPLATE","generate","baseTableName","projectId","tableTime","content","fininalTableName","GenerateSQL","signature","description","execute","args","options","projectIdList","startAtYm","finishAtYm","commonSqlContent","finishAtMoment","COMMAND_ARGUMENT_BY_MONTH","sqlContent","currentAtMoment","isBefore","add","curremtAtYM","insertProjectInfo","handle","catch","e","log","stack","message","console"],"mappings":"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,GAAtC;AACD;;AACD,IAAImC,cAAc,GAAG,EAArB;AACAA,cAAc,CAACpF,kBAAD,CAAd,GAAsC;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAbA;AAeAoF,cAAc,CAACnF,gCAAD,CAAd,GAAoD;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qEAdA;AAgBAmF,cAAc,CAAClF,gCAAD,CAAd,GAAoD;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2EAZA;AAcAkF,cAAc,CAACjF,kCAAD,CAAd,GAAsD;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uEAhBA;AAkBAiF,cAAc,CAAChF,oBAAD,CAAd,GAAwC;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8DAXA;AAaAgF,cAAc,CAAC/E,yBAAD,CAAd,GAA6C;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uEAZA;AAcA+E,cAAc,CAAC5E,iCAAD,CAAd,GAAqD;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sEAXA;AAaA4E,cAAc,CAAC9E,wBAAD,CAAd,GAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sEAZA;AAcA8E,cAAc,CAAC7E,oBAAD,CAAd,GAAwC;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wEAZA;AAcA6E,cAAc,CAAC3E,sBAAD,CAAd,GAA0C;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8DAXA;AAaA2E,cAAc,CAACrE,iBAAD,CAAd,GAAqC;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CArBA;AAsBAqE,cAAc,CAACpE,qBAAD,CAAd,GAAyC;AACzC;AACA;AACA;AACA;AACA;AACA;AACA,CAPA;AASAoE,cAAc,CAACnE,mBAAD,CAAd,GAAuC;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAbA;AAcAmE,cAAc,CAAClE,2BAAD,CAAd,GAA+C;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA,CAPA;AASAkE,cAAc,CAACjE,qBAAD,CAAd,GAAyC;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAfA;AAiBAiE,cAAc,CAAChE,2BAAD,CAAd,GAA+C;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAtBA;AAuBAgE,cAAc,CAAC/D,6BAAD,CAAd,GAAiD;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAfA;AAgBA+D,cAAc,CAAC9D,uBAAD,CAAd,GAA2C;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAdA;AAeA8D,cAAc,CAACtE,oBAAD,CAAd,GAAwC;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAbA;AAcA;;AACAsE,cAAc,CAAC1E,uBAAD,CAAd,GAA2C;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAlBA;AAmBA0E,cAAc,CAACzE,eAAD,CAAd,GAAmC;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAlBA;AAmBAyE,cAAc,CAA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","sourcesContent":["import Base from '~/src/commands/base'\nimport moment from 'moment'\nimport DATE_FORMAT from '~/src/constants/date_format'\nimport MPerformance from '~/src/model/parse/performance'\nimport Knex from '~/src/library/mysql'\n\nconst SQL_DATE_FORMAT_YM = 'YYYYMM'\n\n// 不需要分表\nconst SINGLE_T_O_PROJECT = 't_o_project' //  项目表\nconst SINGLE_T_R_BEHAVIOR_DISTRIBUTION = 't_r_behavior_distribution' //  用户点击记录表\nconst SINGLE_T_R_DURATION_DISTRIBUTION = 't_r_duration_distribution' // 用户停留时长分布表\nconst SINGLE_T_R_HTTP_ERROR_DISTRIBUTION = 't_r_http_error_distribution' // 错误分布表\nconst SINGLE_T_R_PAGE_VIEW = 't_r_page_view' //  pv 表\nconst SINGLE_T_R_SYSTEM_BROWSER = 't_r_system_browser' //  浏览器分布表\nconst SINGLE_T_R_SYSTEM_DEVICE = 't_r_system_device' // 设备分布表\nconst SINGLE_T_R_SYSTEM_OS = 't_r_system_os' //  操作系统分布表\nconst SINGLE_T_R_SYSTEM_RUNTIME_VERSION = 't_r_system_runtime_version' // 项目版本表\nconst SINGLE_T_R_UNIQUE_VIEW = 't_r_unique_view' //  uv表\nconst SINGLE_T_O_ALARM_CONFIG = 't_o_alarm_config' // 项目配置表\nconst SINGLE_T_O_USER = 't_o_user' // 用户表\nconst SINGLE_T_O_PROJECT_MEMBER = 't_o_project_member' // 项目成员表\nconst SINGLE_T_O_NEW_USER_SUMMARY = 't_r_new_user_summary' // 新用户统计表\nconst SINGLE_T_R_ALARM_LOG = 't_r_alarm_log' // 报警记录表\n\n// 需要分表\nconst MUILT_T_O_MONITOR = 't_o_monitor' //  异常数据表, 按项目按月分表, 只有最基础的错误信息, ext字段需要到详情表中单独获取, 命名规则: t_o_monitor_项目id_YYYYMM\nconst MUILT_T_O_MONITOR_EXT = 't_o_monitor_ext' // 异常数据的ext信息, 按项目按月分表, 命名规则: t_o_monitor_ext_项目id_YYYYMM\nconst MUILT_T_O_UV_RECORD = 't_o_uv_record' // uv记录表, 按项目&月分表,最小统计粒度为小时 命名规则: t_o_uv_record_项目id_YYYYMM\nconst MUILT_T_R_CITY_DISTRIBUTION = 't_r_city_distribution' // 城市数据的扩展信息, 按项目按月分表, 命名规则: t_r_city_distribution_项目id_YYYYMM, 获取数据时, 以记录创建时间和记录所属项目id, 决定distribute记录所在表\nconst MUILT_T_R_PERFORMANCE = 't_r_performance' // 性能指标表, 按项目按月分表, 命名规则: t_r_performance_项目id_YYYYMM, 获取数据时, 以记录创建时间和记录所属项目id, 决定distribute记录所在表\nconst MUILT_T_O_SYSTEM_COLLECTION = 't_o_system_collection' // 设备记录表, 按项目分表, 最小统计粒度为月, 命名规则: t_o_device_info_项目id\nconst MUILT_T_O_USER_FIRST_LOGIN_AT = 't_o_user_first_login_at' // 用户首次登陆表, 用于统计新课, 按项目分表, 命名规则: t_o_customer_first_login_at_项目id\nconst MUILT_T_R_ERROR_SUMMARY = 't_r_error_summary' // 错误统计表,用于统计错误类型，错误名字\n\nlet urlList = ['http://127.0.0.1:3000/template1', 'http://127.0.0.1:3000/template2', 'http://127.0.0.1:3000/template3']\nlet errorNameList = ['代理异常_Response Code', '代理异常_Response Timeout', 'JS异常_IMAGE_LOAD_ERROR', '加载页面异常_ERR_ABORTED']\n\nasync function getSQL () {\n  let sql = ''\n  let sqlList = []\n  sqlList[0] = getAlarmLog()\n  sqlList[1] = getUserSQL()\n  sqlList[2] = getBehaviorDistribution()\n  sqlList[3] = getErrorSummarySQL()\n  sqlList[4] = getOriginMonitorSQL()\n  sqlList[5] = getIndicatorSQl()\n  sqlList[6] = getOSDistribution()\n  sqlList[7] = getBrowserDistribution()\n  sqlList[8] = getDuration()\n  sqlList[9] = getNewUser()\n  for (let sql of sqlList) {\n    await Knex.schema.raw(sql)\n  }\n  sql = sqlList.join('')\n  return sql\n}\nfunction getUserSQL () {\n  let sql = `\n    REPLACE INTO t_o_user VALUES (1, '9897985048102565651984810257495248', 'test@qq.com', 'test@qq.com', '2e5c42ba59653a8501b37df58c75defc', '你好', 'dev', 'site', 'http://ww1.sinaimg.cn/large/00749HCsly1fwofq2t1kaj30qn0qnaai.jpg', '', '0', 0, 0);\n  `\n  return sql\n}\nfunction getAlarmLog () {\n  let id = 1\n  let sql = `REPLACE INTO \\`t_r_alarm_log\\` (\\`id\\`, \\`project_id\\`, \\`config_id\\`, \\`send_at\\`, \\`error_type\\`, \\`error_name\\`, \\`message\\`, \\`create_time\\`, \\`update_time\\`) VALUES`\n  let timeAt = moment().startOf('day').unix()\n  for (let count = 1; count <= 20; count++) {\n    let index = 1\n    for (let errorName of errorNameList) {\n      sql += `\n      (${id++}, 1, ${index++}, ${timeAt}, '8', '${errorName}', 'alarm message', ${timeAt}, ${timeAt}),`\n      timeAt += 500\n    }\n  }\n  return sql.slice(0, sql.length - 1) + ';'\n}\nfunction getNewUser () {\n  let id = 1\n  let count = [50, 6, 3, 10, 100]\n  let sql = `REPLACE INTO \\`t_r_new_user_summary\\` (\\`id\\`, \\`project_id\\`, \\`total_count\\`, \\`count_at_time\\`, \\`count_type\\`, \\`city_distribute_id\\`, \\`create_time\\`, \\`update_time\\`) VALUES`\n  for (let hour = moment().startOf('day').unix(); hour <= moment().endOf('day').unix(); hour += 3600) {\n    sql += `\n    (${id++}, 1, ${count[id % count.length]}, '${moment.unix(hour).format('YYYY-MM-DD_HH')}', 'hour', ${id}, ${hour}, ${hour}),`\n  }\n  return sql.slice(0, sql.length - 1) + ';'\n}\nfunction getDuration () {\n  let id = 1\n  let stay = [24175534, 2417553, 2418553]\n  let sql = `REPLACE INTO \\`t_r_duration_distribution\\` (\\`id\\`, \\`project_id\\`, \\`total_stay_ms\\`, \\`total_uv\\`, \\`count_at_time\\`, \\`count_type\\`, \\`city_distribute_id\\`, \\`create_time\\`, \\`update_time\\`) VALUES`\n  for (let hour = moment().startOf('day').unix(); hour <= moment().endOf('day').unix(); hour += 3600) {\n    sql += `\n    (${id++}, 1, ${stay[id % stay.length]}, ${id % 5}, '${moment.unix(hour).format('YYYY-MM-DD_HH')}', 'hour', ${id}, ${hour}, ${hour}),`\n  }\n  return sql.slice(0, sql.length - 1) + ';'\n}\nfunction getBrowserDistribution () {\n  let id = 1\n  let browserList = ['chrome', '搜狗', 'uc', '百度']\n  let versions = ['10', '12', '14', '15', '16', '17', '18', '19']\n  let month = moment().format('YYYY-MM')\n  let sql = `\n  REPLACE INTO \\`t_r_system_browser\\` (\\`id\\`, \\`project_id\\`, \\`browser\\`, \\`browser_version\\`, \\`total_count\\`, \\`count_at_month\\`, \\`city_distribute_id\\`, \\`create_time\\`, \\`update_time\\`) VALUES`\n  for (let browser of browserList) {\n    for (let version of versions) {\n      sql += `\n      (${id++}, 1, '${browser}', '${version}', ${id * 2 % 10 + 5}, '${month}', ${id}, ${moment().unix()}, ${moment().unix()}),`\n    }\n  }\n  return sql.slice(0, sql.length - 1) + ';'\n}\nfunction getOSDistribution () {\n  let id = 1\n  let systemList = ['Max OS', 'Windows', 'iOS']\n  let versions = ['10.2.1', '10.2.2', '10.2.3', '10.2.4', '10.2.5', '10.2.6', '10.2.11', '10.2.2']\n  let month = moment().format('YYYY-MM')\n  let sql = `\n  REPLACE INTO \\`t_r_system_os\\` (\\`id\\`, \\`project_id\\`, \\`os\\`, \\`os_version\\`, \\`total_count\\`, \\`count_at_month\\`, \\`city_distribute_id\\`, \\`create_time\\`, \\`update_time\\`) VALUES`\n  for (let system of systemList) {\n    for (let version of versions) {\n      sql += `\n      (${id++}, 1, '${system}', '${version}', ${id * 2 % 10 + 5}, '${month}', ${id}, ${moment().unix()}, ${moment().unix()}),`\n    }\n  }\n  return sql.slice(0, sql.length - 1) + ';'\n}\nfunction getIndicatorSQl () {\n  let id = 1\n  let indicatorList = MPerformance.INDICATOR_TYPE_LIST\n  let nowMoment = moment()\n  let tableName = 't_r_performance_1_' + nowMoment.format('YYYYMM')\n  let sql = `\n  REPLACE INTO \\`${tableName}\\` (\\`id\\`, \\`sum_indicator_value\\`, \\`pv\\`, \\`indicator\\`, \\`url\\`, \\`city_distribute_id\\`, \\`count_at_time\\`, \\`count_type\\`, \\`create_time\\`, \\`update_time\\`) VALUES`\n  for (let timeAt = nowMoment.clone().subtract(3, 'hour').unix(); timeAt <= nowMoment.unix(); timeAt += 60) {\n    sql += `\n    (${id++}, ${id % 10}, ${id % 5}, '${indicatorList[id % indicatorList.length]}', '${urlList[id % urlList.length]}', ${id}, '${moment.unix(timeAt).format('YYYY-MM-DD_HH:mm')}', 'minute', ${timeAt}, ${timeAt}),`\n  }\n  for (let timeAt = nowMoment.clone().subtract(48, 'hour').unix(); timeAt <= nowMoment.unix(); timeAt += 3600) {\n    sql += `\n    (${id++}, ${id % 10}, ${id % 5}, '${indicatorList[id % indicatorList.length]}', '${urlList[id % urlList.length]}', ${id}, '${moment.unix(timeAt).format('YYYY-MM-DD_HH')}', 'hour', ${timeAt}, ${timeAt}),`\n  }\n  return sql.slice(0, sql.length - 1) + ';'\n}\nfunction getOriginMonitorSQL () {\n  let nowMoment = moment()\n  let startDayMoment = moment().startOf('day')\n  let tableName = 't_o_monitor_1_' + nowMoment.format('YYYYMM')\n  let id = 1\n  let sql = `\n  REPLACE INTO \\`${tableName}\\` (\\`id\\`, \\`error_type\\`, \\`error_name\\`, \\`http_code\\`, \\`monitor_ext_id\\`, \\`during_ms\\`, \\`request_size_b\\`, \\`response_size_b\\`, \\`url\\`, \\`country\\`, \\`province\\`, \\`city\\`, \\`log_at\\`, \\`md5\\`, \\`create_time\\`, \\`update_time\\`) VALUES`\n  for (let logAt = startDayMoment.unix(), count = 1; logAt <= nowMoment.unix() && count <= 100; logAt += 120, count++) {\n    sql += `\n    (${id++}, '8', '${errorNameList[id % errorNameList.length]}', '400', ${id}, '10', '10', '10', '${urlList[id % urlList.length]}', '中国', '河南', '安阳', '${logAt}', 'md5', ${logAt}, ${logAt}),`\n  }\n  return sql.slice(0, sql.length - 1) + ';'\n}\nfunction getBehaviorDistribution () {\n  let nowMoment = moment()\n  let nowDay = nowMoment.date()\n  let threeDayAgo = nowDay - 3\n  let code = ['SIDE_A01B02', 'SIDE_A01B0', 'SIDE_A01B', 'SIDE_A01']\n  let name = ['用户', '产品', 'url', '错误页面']\n  let id = 101\n  let sql = `\n  REPLACE INTO \\`t_r_behavior_distribution\\` (\\`id\\`, \\`project_id\\`, \\`code\\`, \\`name\\`, \\`url\\`, \\`total_count\\`, \\`count_at_time\\`, \\`count_type\\`, \\`city_distribute_id\\`, \\`create_time\\`, \\`update_time\\`) VALUES `\n  if (threeDayAgo < 0) threeDayAgo = 0\n  for (let day = threeDayAgo; day <= nowDay; day++) {\n    for (let hour = 0; hour <= 23; hour++) {\n      sql += `\n      (${id++},1, '${code[id % code.length]}', '${name[id % name.length]}', '${urlList[id % urlList.length]}', ${id % 30}, '${nowMoment.format('YYYY-MM-') + day.toString().padStart(2, '0') + '_' + hour.toString().padStart(2, '0')}', 'day', ${id}, ${moment().unix()}, ${moment().unix()}),\n      `\n    }\n    sql += `\n    (${id++},1, '${code[id % code.length]}', '${name[id % name.length]}', '${urlList[id % urlList.length]}', ${id % 30}, '${nowMoment.format('YYYY-MM-') + day.toString().padStart(2, '0')}', 'day', ${id}, ${moment().unix()}, ${moment().unix()}),`\n  }\n  return sql.slice(0, sql.length - 1) + ';'\n}\nfunction getErrorSummarySQL () {\n  let id = 1\n  let nowMoment = moment()\n  let tableName = 't_r_error_summary_1_' + nowMoment.format('YYYYMM')\n  let monthPrefix = nowMoment.format('YYYY-MM')\n  let timeStrPrefix = nowMoment.format('YYYY-MM-DD')\n  let sql = `\n  REPLACE INTO \\`${tableName}\\` (\\`id\\`, \\`error_type\\`, \\`error_name\\`, \\`url_path\\`, \\`city_distribution_id\\`, \\`count_at_time\\`, \\`count_type\\`, \\`error_count\\`, \\`create_time\\`, \\`update_time\\`) VALUES `\n  let nowHour = nowMoment.hour()\n  let endHour = nowHour - 3\n  if (endHour < 0) endHour = 0\n  for (let hour = endHour; hour <= nowHour; hour++) {\n    let hourStr = (hour + '').padStart(2, '0')\n    for (let minute = 0; minute < 60; minute++) {\n      let minuteStr = (minute + '').padStart(2, '0')\n      sql += `(${id++}, '8', '${errorNameList[id % errorNameList.length]}', '${urlList[id % urlList.length]}', ${id}, '${timeStrPrefix + '_' + hourStr + ':' + minuteStr}', 'minute', ${id % 10}, ${moment().unix()}, ${moment().unix()}),\n      `\n    }\n    sql += `(${id++}, '8', '${errorNameList[id % errorNameList.length]}', '${urlList[id % urlList.length]}', ${id}, '${timeStrPrefix + '_' + hourStr}', 'hour', ${id % 100}, ${moment().unix()}, ${moment().unix()}),`\n  }\n  for (let day = nowMoment.date(), count = 1; count <= 30; count++) {\n    sql += `\n    (${id++}, '8', '${errorNameList[id % errorNameList.length]}', '${urlList[id % urlList.length]}', ${id}, '${monthPrefix + '-' + day.toString().padStart(2, '0')}', 'day', ${id % 100}, ${moment().unix()}, ${moment().unix()}),`\n  }\n  return sql.slice(0, sql.length - 1) + ';'\n}\nlet TABLE_TEMPLATE = {}\nTABLE_TEMPLATE[SINGLE_T_O_PROJECT] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '项目id',\n  \\`display_name\\` varchar(50) NOT NULL DEFAULT '' COMMENT '项目名称',\n  \\`project_name\\` varchar(50) NOT NULL DEFAULT '' COMMENT '项目代号(替代项目id, 方便debug)',\n  \\`c_desc\\` varchar(100) NOT NULL DEFAULT '' COMMENT '备注信息',\n  \\`rate\\` int(10) NOT NULL DEFAULT '10000' COMMENT '数据抽样比率',\n  \\`is_delete\\` tinyint(1) NOT NULL DEFAULT '0' COMMENT '是否已删除(1 => 是, 0 => 否)',\n  \\`create_ucid\\` varchar(20) NOT NULL DEFAULT '' COMMENT '创建人ucid',\n  \\`update_ucid\\` varchar(20) NOT NULL DEFAULT '' COMMENT '更新人ucid',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  UNIQUE KEY \\`uniq_project_name\\` (\\`project_name\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='项目表';`\n\nTABLE_TEMPLATE[SINGLE_T_R_BEHAVIOR_DISTRIBUTION] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`code\\` varchar(50) NOT NULL DEFAULT '' COMMENT '用户行为标识',\n  \\`name\\` varchar(50) NOT NULL DEFAULT '' COMMENT '用户点击名称',\n  \\`url\\` varchar(200) NOT NULL DEFAULT '' COMMENT '用户点击页面',\n  \\`total_count\\` int(10) NOT NULL DEFAULT '0' COMMENT '点击总量',\n  \\`count_at_time\\` varchar(30) NOT NULL DEFAULT '' COMMENT '统计日期,格式根据统计尺度不同有三种可能,  hour => YYYY-MM-DD_HH, day => YYYY-MM-DD, month => YYYY-MM',\n  \\`count_type\\` varchar(20) NOT NULL DEFAULT 'day' COMMENT '统计尺度(hour/day/month)',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布详情记录id',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  KEY \\`idx_project_id_count_type_count_at_time\\` (\\`project_id\\`, \\`count_type\\`, \\`count_at_time\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户点击记录表, 最小统计粒度为天';`\n\nTABLE_TEMPLATE[SINGLE_T_R_DURATION_DISTRIBUTION] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`total_stay_ms\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '总停留毫秒数',\n  \\`total_uv\\` int(10) NOT NULL DEFAULT '0' COMMENT '总uv数(从uv表中获取)',\n  \\`count_at_time\\` varchar(30) NOT NULL DEFAULT '' COMMENT '统计日期,格式根据统计尺度不同有两种可能, day => YYYY-MM-DD, month => YYYY-MM',\n  \\`count_type\\` varchar(20) NOT NULL DEFAULT 'day' COMMENT '统计尺度(day/month)',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布详情记录id',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  PRIMARY KEY (\\`id\\`),\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  KEY \\`idx_project_id_count_type_count_at_time\\` (\\`project_id\\`, \\`count_type\\`, \\`count_at_time\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户停留时长分布, 不分表，按天和按月进行统计';`\n\nTABLE_TEMPLATE[SINGLE_T_R_HTTP_ERROR_DISTRIBUTION] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`total_count\\` int(10) NOT NULL DEFAULT '0' COMMENT 'http响应码总数',\n  \\`http_code_2xx_count\\` int(10) NOT NULL DEFAULT '0' COMMENT 'http响应码2xx总数',\n  \\`http_code_3xx_count\\` int(10) NOT NULL DEFAULT '0' COMMENT 'http响应码3xx总数',\n  \\`http_code_4xx_count\\` int(10) NOT NULL DEFAULT '0' COMMENT 'http响应码4xx总数',\n  \\`http_code_5xx_count\\` int(10) NOT NULL DEFAULT '0' COMMENT 'http响应码5xx总数',\n  \\`http_code_other_count\\` int(10) NOT NULL DEFAULT '0' COMMENT '其他http响应码总数',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布详情记录id',\n  \\`count_at_time\\` varchar(30) NOT NULL DEFAULT '' COMMENT '统计日期,格式根据统计尺度不同有三种可能,  hour => YYYY-MM-DD_HH, day => YYYY-MM-DD, month => YYYY-MM',\n  \\`count_type\\` varchar(20) NOT NULL DEFAULT 'hour' COMMENT '统计尺度(hour/day/month)',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  PRIMARY KEY (\\`id\\`),\n  KEY \\`idx_project_id_count_type_count_at_time\\` (\\`project_id\\`, \\`count_type\\`, \\`count_at_time\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='错误分布, 不分表，按天和按月进行统计';`\n\nTABLE_TEMPLATE[SINGLE_T_R_PAGE_VIEW] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`total_count\\` int(10) NOT NULL DEFAULT '0' COMMENT 'pv数',\n  \\`count_at_time\\` varchar(30) NOT NULL DEFAULT '' COMMENT '统计日期,格式根据统计尺度不同有三种可能,  hour => YYYY-MM-DD_HH, day => YYYY-MM-DD, month => YYYY-MM',\n  \\`count_type\\` varchar(20) NOT NULL DEFAULT 'hour' COMMENT '统计尺度(hour/day/month)',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布记录id',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  UNIQUE KEY \\`uniq_project_id_count_type_count_at_time\\` (\\`project_id\\`,\\`count_type\\`,\\`count_at_time\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='pv记录表, 不分表';`\n\nTABLE_TEMPLATE[SINGLE_T_R_SYSTEM_BROWSER] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`browser\\` varchar(20) NOT NULL DEFAULT '' COMMENT '浏览器品牌',\n  \\`browser_version\\` varchar(50) NOT NULL DEFAULT '' COMMENT '浏览器详情',\n  \\`total_count\\` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '数量总和',\n  \\`count_at_month\\` varchar(15) NOT NULL DEFAULT '' COMMENT '统计时间段, YYYY-MM格式 => 2018-09',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布记录id',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  KEY \\`idx_project_id_count_at_month\\` (\\`project_id\\`, \\`count_at_month\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='浏览器分布数据表, 不分表, 按月统计';`\n\nTABLE_TEMPLATE[SINGLE_T_R_SYSTEM_RUNTIME_VERSION] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`runtime_version\\` varchar(50) NOT NULL DEFAULT '' COMMENT '应用版本号',\n  \\`total_count\\` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '数量总和',\n  \\`count_at_month\\` varchar(15) NOT NULL DEFAULT '' COMMENT '统计时间段, YYYY-MM格式 => 2018-09',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布记录id',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  KEY \\`idx_project_id_count_at_month\\` (\\`project_id\\`, \\`count_at_month\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='版本分布数据表, 不分表, 按月统计';`\n\nTABLE_TEMPLATE[SINGLE_T_R_SYSTEM_DEVICE] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`device_vendor\\` varchar(50) NOT NULL DEFAULT '' COMMENT '设备制造商',\n  \\`device_model\\` varchar(50) NOT NULL DEFAULT '' COMMENT '设备详情',\n  \\`total_count\\` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '数量总和',\n  \\`count_at_month\\` varchar(15) NOT NULL DEFAULT '' COMMENT '统计时间段, YYYY-MM格式 => 2018-09',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布记录id',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  KEY \\`idx_project_id_count_at_month\\` (\\`project_id\\`, \\`count_at_month\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='设备分布数据表, 不分表, 按月统计';`\n\nTABLE_TEMPLATE[SINGLE_T_R_SYSTEM_OS] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`os\\` varchar(50) NOT NULL DEFAULT '' COMMENT '操作系统名',\n  \\`os_version\\` varchar(50) NOT NULL DEFAULT '' COMMENT '操作系统版本',\n  \\`total_count\\` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '数量总和',\n  \\`count_at_month\\` varchar(15) NOT NULL DEFAULT '' COMMENT '统计时间段, YYYY-MM格式 => 2018-09',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布记录id',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  KEY \\`idx_project_id_count_at_month\\` (\\`project_id\\`, \\`count_at_month\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='操作系统分布数据表, 不分表, 按月统计';`\n\nTABLE_TEMPLATE[SINGLE_T_R_UNIQUE_VIEW] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`total_count\\` int(10) NOT NULL DEFAULT '0' COMMENT 'uv数',\n  \\`count_at_time\\` varchar(30) NOT NULL DEFAULT '' COMMENT '统计日期,格式根据统计尺度不同有三种可能,  hour => YYYY-MM-DD_HH, day => YYYY-MM-DD, month => YYYY-MM',\n  \\`count_type\\` varchar(20) NOT NULL DEFAULT 'hour' COMMENT '统计尺度(hour/day/month)',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布记录id',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  UNIQUE KEY \\`uniq_project_id_count_type_count_at_time\\` (\\`project_id\\`,\\`count_type\\`,\\`count_at_time\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='uv记录表, 不分表';`\n\nTABLE_TEMPLATE[MUILT_T_O_MONITOR] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`error_type\\` varchar(20) NOT NULL DEFAULT '' COMMENT '异常类型(目前是四种,分别对应前端的四种报错类型: api_data =>前端数据结构报警, start_process => 启动过程异常, load_wv => Url加载空服务报警, api_code => 请求接口异常报警)',\n  \\`error_name\\` varchar(255) NOT NULL DEFAULT '' COMMENT '错误名/错误代码,用于细分错误类别',\n  \\`http_code\\` int(10) NOT NULL DEFAULT '0' COMMENT 'http状态码, 没有则为0',\n  \\`monitor_ext_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '详情id',\n  \\`during_ms\\` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '接口请求时长, 单位毫秒',\n  \\`request_size_b\\` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '接口请求体积, 单位b',\n  \\`response_size_b\\` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '接口响应体积, 单位b',\n  \\`url\\` varchar(255) NOT NULL DEFAULT '' COMMENT '发生异常的url',\n  \\`country\\` varchar(10) NOT NULL DEFAULT '' COMMENT '所属国家',\n  \\`province\\` varchar(15) NOT NULL DEFAULT '' COMMENT '所属省份',\n  \\`city\\` varchar(15) NOT NULL DEFAULT '' COMMENT '所属城市',\n  \\`log_at\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '日志记录时间',\n  \\`md5\\` char(32) NOT NULL DEFAULT '' COMMENT '记录生成MD5',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  UNIQUE KEY \\`uniq_log_at_md5\\` (\\`log_at\\`,\\`md5\\`),\n  KEY \\`idx_log_at_error_type_error_name_url\\` (\\`log_at\\`,\\`error_type\\`,\\`error_name\\`,\\`url\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='异常数据表, 按项目按月分表, 只有最基础的错误信息, ext字段需要到详情表中单独获取, 命名规则: t_o_monitor_项目id_YYYYMM';\n`\nTABLE_TEMPLATE[MUILT_T_O_MONITOR_EXT] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`ext_json\\` text COMMENT '异常记录扩展信息',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='异常数据的ext信息, 按项目按月分表, 命名规则: t_o_monitor_ext_项目id_YYYYMM';\n`\n\nTABLE_TEMPLATE[MUILT_T_O_UV_RECORD] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '项目id',\n  \\`uuid\\` varchar(50) NOT NULL DEFAULT '' COMMENT '设备唯一标识',\n  \\`country\\` varchar(10) NOT NULL DEFAULT '' COMMENT '所属国家',\n  \\`province\\` varchar(15) NOT NULL DEFAULT '' COMMENT '所属省份',\n  \\`city\\` varchar(15) NOT NULL DEFAULT '' COMMENT '所属城市',\n  \\`visit_at_hour\\` varchar(20) NOT NULL DEFAULT '' COMMENT '访问日期, 数据格式为 YYYY-MM-DD_HH demo => 2018-08-02_23',\n  \\`pv_count\\` int(10) NOT NULL DEFAULT '0' COMMENT '时间段内同一uuid访问次数, 用于计算总pv',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  UNIQUE KEY \\`uniq_visit_at_hour_uuid\\` (\\`visit_at_hour\\`,\\`uuid\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='uv记录表, 按项目&月分表,最小统计粒度为小时 命名规则: t_o_uv_record_项目id_YYYYMM';\n        `\nTABLE_TEMPLATE[MUILT_T_R_CITY_DISTRIBUTION] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`city_distribute_json\\` text COMMENT '扩展字段',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='城市数据的扩展信息, 按项目按月分表, 命名规则: t_r_city_distribution_项目id_YYYYMM, 获取数据时, 以记录创建时间和记录所属项目id, 决定distribute记录所在表';\n`\n\nTABLE_TEMPLATE[MUILT_T_R_PERFORMANCE] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`sum_indicator_value\\` bigInt(10) NOT NULL DEFAULT '0' COMMENT '性能指标求和',\n  \\`pv\\` bigInt(10) NOT NULL DEFAULT '0' COMMENT '性能指标pv数,用于计算平均时长',\n  \\`indicator\\` varchar(50) NOT NULL DEFAULT '' COMMENT '性能指标:DNS响应时间/TCP时间/404数量/etc',\n  \\`url\\` varchar(255) NOT NULL DEFAULT '' COMMENT '页面url',\n  \\`city_distribute_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '城市分布详情记录id',\n  \\`count_at_time\\` varchar(20) NOT NULL DEFAULT '' COMMENT '统计日期,格式根据统计尺度不同有四种可能,  minute => YYYY-MM-DD_HH:mm, hour => YYYY-MM-DD_HH, day => YYYY-MM-DD, month => YYYY-MM',\n  \\`count_type\\` varchar(10) NOT NULL DEFAULT 'minute' COMMENT '统计尺度(minute/hour/day/month)',\n\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '更新时间',\n  PRIMARY KEY (\\`id\\`),\n  KEY \\`idx_count_at_time_count_type_url_indicator\\` (\\`count_at_time\\`, \\`count_type\\`, \\`url\\`, \\`indicator\\`)\n  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='性能指标表, 按项目按月分表, 索引应为唯一索引, 但是长度超限, 因此只能使用index';\n  `\n\nTABLE_TEMPLATE[MUILT_T_O_SYSTEM_COLLECTION] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`uuid\\` varchar(50) NOT NULL DEFAULT '' COMMENT '设备唯一标识',\n  \\`browser\\` varchar(50) NOT NULL DEFAULT '' COMMENT '浏览器品牌',\n  \\`browser_version\\` varchar(100) NOT NULL DEFAULT '' COMMENT '浏览器版本详情',\n  \\`engine\\` varchar(100) NOT NULL DEFAULT '' COMMENT '内核名称',\n  \\`engine_version\\` varchar(100) NOT NULL DEFAULT '' COMMENT '内核版本详情',\n  \\`device_vendor\\` varchar(100) NOT NULL DEFAULT '' COMMENT '手机品牌',\n  \\`device_model\\` varchar(100) NOT NULL DEFAULT '' COMMENT '手机型号',\n  \\`os\\` varchar(50) NOT NULL DEFAULT '' COMMENT '操作系统',\n  \\`os_version\\` varchar(50) NOT NULL DEFAULT '' COMMENT '操作系统详情',\n  \\`country\\` varchar(10) NOT NULL DEFAULT '' COMMENT '所属国家',\n  \\`province\\` varchar(15) NOT NULL DEFAULT '' COMMENT '所属省份',\n  \\`city\\` varchar(15) NOT NULL DEFAULT '' COMMENT '所属城市',\n  \\`runtime_version\\` varchar(50) NOT NULL DEFAULT '' COMMENT '应用版本',\n  \\`visit_at_month\\` varchar(20) NOT NULL DEFAULT '' COMMENT '访问日期, 数据格式为 YYYY-MM demo => 2018-09',\n  \\`log_at\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '日志记录时间',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  UNIQUE KEY \\`uniq_visit_at_month_uuid\\` (\\`visit_at_month\\`,\\`uuid\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='设备记录表, 按项目分表, 最小统计粒度为月, 命名规则: t_o_device_info_项目id';\n`\nTABLE_TEMPLATE[MUILT_T_O_USER_FIRST_LOGIN_AT] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`ucid\\` varchar(20) NOT NULL DEFAULT '' COMMENT '用户id',\n  \\`first_visit_at\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '用户首次访问时间',\n\n  \\`country\\` varchar(10) NOT NULL DEFAULT '' COMMENT '所属国家',\n  \\`province\\` varchar(15) NOT NULL DEFAULT '' COMMENT '所属省份',\n  \\`city\\` varchar(15) NOT NULL DEFAULT '' COMMENT '所属城市',\n\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '更新时间',\n  PRIMARY KEY (\\`id\\`),\n  UNIQUE KEY \\`uniq_ucid\\` (\\`ucid\\`),\n  INDEX \\`idx_first_visit_at\\` (\\`first_visit_at\\`)\n  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='新用户记录表, 按项目分表, 命名规则: t_o_customer_first_login_at_项目id';\n`\nTABLE_TEMPLATE[MUILT_T_R_ERROR_SUMMARY] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`error_type\\` varchar(20) NOT NULL DEFAULT '' COMMENT '错误类型',\n  \\`error_name\\` varchar(255) NOT NULL DEFAULT '' COMMENT '错误名字',\n  \\`url_path\\` varchar(255) NOT NULL DEFAULT '' COMMENT '错误URL_PATH',\n  \\`city_distribution_id\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '城市分布详情id',\n  \\`count_at_time\\` varchar(20) NOT NULL DEFAULT '' COMMENT '统计时间(按类型不同,day:YYYY-MM-DD;hour:YYYY-MM-DD_HH;minute:YYYY-MM-DD_HH:mm)',\n  \\`count_type\\` varchar(10) NOT NULL DEFAULT 'day' COMMENT '统计类型(day天,hour小时,minute分)',\n  \\`error_count\\` int(10) NOT NULL DEFAULT '0' COMMENT '数量总和',\n  \\`create_time\\` int(20) NOT NULL DEFAULT '0' COMMENT '创建时间',\n  \\`update_time\\` int(20) NOT NULL DEFAULT '0' COMMENT '更新时间',\n  PRIMARY KEY (\\`id\\`),\n  KEY \\`idx_count_at_time_count_type_error_type_error_name\\` (\\`count_at_time\\`,\\`count_type\\`,\\`error_type\\`,\\`error_name\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='按项目,按月统计error错误';\n`\nTABLE_TEMPLATE[SINGLE_T_R_ALARM_LOG] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '要报警项目id',\n  \\`config_id\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '报警配置id',\n  \\`send_at\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '报警时间戳',\n  \\`error_type\\` varchar(20) NOT NULL DEFAULT '' COMMENT '错误类型',\n  \\`error_name\\` varchar(255) NOT NULL DEFAULT '' COMMENT '错误名字',\n  \\`message\\` varchar(500) NOT NULL DEFAULT '' COMMENT '报警信息',\n  \\`create_time\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '创建时间',\n  \\`update_time\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '更新时间',\n  PRIMARY KEY (\\`id\\`),\n  KEY \\`idx_send_at_project_id\\` (\\`send_at\\`,\\`project_id\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n`\n/** ************************** MULTI & SINGLE ******************************************/\nTABLE_TEMPLATE[SINGLE_T_O_ALARM_CONFIG] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT,\n  \\`project_id\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '要报警项目id',\n  \\`owner_ucid\\` varchar(20) NOT NULL DEFAULT '' COMMENT '项目所有人id',\n  \\`error_type\\` varchar(20) NOT NULL DEFAULT '' COMMENT '报警错误类型',\n  \\`error_name\\` varchar(255) NOT NULL DEFAULT '' COMMENT '要报警错误名字',\n  \\`time_range_s\\` int(20) unsigned NOT NULL DEFAULT '0' COMMENT '报警时间范围_秒',\n  \\`max_error_count\\` int(20) unsigned NOT NULL DEFAULT '0' COMMENT '报警错误数阈值',\n  \\`alarm_interval_s\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '报警时间间隔_秒',\n  \\`is_enable\\` tinyint(1) unsigned NOT NULL DEFAULT '1' COMMENT '是否开启本条报警配置1：是0：否',\n  \\`note\\` varchar(255) NOT NULL DEFAULT '' COMMENT '配置说明',\n  \\`is_delete\\` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '是否删除(1 => 是, 0 => 否)',\n  \\`create_ucid\\` varchar(20) NOT NULL DEFAULT '' COMMENT '创建此记录的人',\n  \\`update_ucid\\` varchar(20) NOT NULL DEFAULT '' COMMENT '更新此记录的人',\n  \\`create_time\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '创建此记录的时间',\n  \\`update_time\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '更新此记录的时间',\n  PRIMARY KEY (\\`id\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='项目报警配置表';\n`\nTABLE_TEMPLATE[SINGLE_T_O_USER] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`ucid\\` varchar(50) NOT NULL DEFAULT '' COMMENT '贝壳ucid',\n  \\`account\\` varchar(50) NOT NULL DEFAULT '' COMMENT '账户名,不能重复',\n  \\`email\\` varchar(50) NOT NULL DEFAULT '' COMMENT '邮箱',\n  \\`password_md5\\` varchar(32) NOT NULL DEFAULT '' COMMENT 'md5后的password',\n  \\`nickname\\` varchar(20) NOT NULL DEFAULT '' COMMENT '昵称',\n  \\`role\\` varchar(50) NOT NULL DEFAULT 'dev' COMMENT '角色(dev => 开发者,admin => 管理员)',\n  \\`register_type\\` varchar(20) NOT NULL DEFAULT 'site' COMMENT '注册类型(site => 网站注册, third => 第三方登录)',\n  \\`avatar_url\\` varchar(200) NOT NULL DEFAULT 'http://ww1.sinaimg.cn/large/00749HCsly1fwofq2t1kaj30qn0qnaai.jpg' COMMENT '头像地址, 默认使用贝壳logo',\n  \\`mobile\\` varchar(20) NOT NULL DEFAULT '' COMMENT '手机号',\n  \\`is_delete\\` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '是否删除(1 => 是, 0 => 否)',\n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '数据库更新时间',\n  PRIMARY KEY (\\`id\\`),\n  UNIQUE KEY \\`uniq_ucid\\` (\\`ucid\\`),\n  UNIQUE KEY \\`uniq_account\\` (\\`account\\`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户信息表';\n`\nTABLE_TEMPLATE[SINGLE_T_O_PROJECT_MEMBER] = `(\n    \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT,\n    \\`project_id\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '项目id',\n    \\`ucid\\` varchar(20) NOT NULL DEFAULT '' COMMENT '项目参与者ucid',\n    \\`role\\` varchar(20) NOT NULL DEFAULT '' COMMENT '参与者角色(owner => 组长, dev => 成员)',\n    \\`need_alarm\\` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '是否需要报警(0 => 不需要, 1 => 需要)',\n    \\`is_delete\\` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '是否已删除(0 => 未删除, 1 => 已删除)',\n    \\`create_ucid\\` varchar(20) NOT NULL DEFAULT '' COMMENT '创建者ucid',\n    \\`update_ucid\\` varchar(20) NOT NULL DEFAULT '' COMMENT '更新者ucid',\n    \\`create_time\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '创建此记录的时间',\n    \\`update_time\\` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '更新此记录的时间',\n    PRIMARY KEY (\\`id\\`)\n  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='项目成员表';\n`\nTABLE_TEMPLATE[SINGLE_T_O_NEW_USER_SUMMARY] = `(\n  \\`id\\` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '记录id',\n  \\`project_id\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '项目id',\n  \\`total_count\\` int(10)    NOT NULL DEFAULT '0' COMMENT '数量总和',\n  \\`count_at_time\\` varchar(20) NOT NULL DEFAULT '' COMMENT '统计日期,格式根据统计尺度不同三两种可能, hour => YYYY-MM-DD_HH, day => YYYY-MM-DD, month => YYYY-MM',\n  \\`count_type\\` varchar(10) NOT NULL DEFAULT 'day' COMMENT '统计尺度(hour/day/month)',\n  \n  \\`city_distribute_id\\` bigint(10) NOT NULL DEFAULT 0 COMMENT '城市分布详情记录id',\n  \n  \\`create_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '创建时间',\n  \\`update_time\\` bigint(20) NOT NULL DEFAULT '0' COMMENT '更新时间',\n  PRIMARY KEY (\\`id\\`),\n  INDEX \\`idx_count_at_time_project_id\\` (\\`count_at_time\\`, \\`project_id\\`)\n  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='新用户统计表, 不分表';\n`\n\nfunction generate (baseTableName, projectId = '', tableTime = '') {\n  // 获取模板\n  let content = TABLE_TEMPLATE[baseTableName]\n\n  // 生成表名\n  let fininalTableName = `${baseTableName}`\n  switch (baseTableName) {\n    case MUILT_T_O_MONITOR:\n      fininalTableName = `${fininalTableName}_${projectId}_${tableTime}`\n      break\n    case MUILT_T_O_MONITOR_EXT:\n      fininalTableName = `${fininalTableName}_${projectId}_${tableTime}`\n      break\n    case MUILT_T_O_UV_RECORD:\n      fininalTableName = `${fininalTableName}_${projectId}_${tableTime}`\n      break\n    case MUILT_T_R_CITY_DISTRIBUTION:\n      fininalTableName = `${fininalTableName}_${projectId}_${tableTime}`\n      break\n    case MUILT_T_R_PERFORMANCE:\n      fininalTableName = `${fininalTableName}_${projectId}_${tableTime}`\n      break\n    case MUILT_T_O_SYSTEM_COLLECTION:\n      fininalTableName = `${fininalTableName}_${projectId}`\n      break\n    case MUILT_T_O_USER_FIRST_LOGIN_AT:\n      fininalTableName = `${fininalTableName}_${projectId}`\n      break\n    case MUILT_T_R_ERROR_SUMMARY:\n      fininalTableName = `${fininalTableName}_${projectId}_${tableTime}`\n      break\n    default:\n  }\n\n  return `CREATE TABLE  IF NOT EXISTS  \\`${fininalTableName}\\` ${content}\n`\n}\n\nclass GenerateSQL extends Base {\n  static get signature () {\n    return `\n       Utils:TemplateSQL\n       `\n  }\n\n  static get description () {\n    return '生成项目在指定日期范围内的建表SQL'\n  }\n\n  async execute (args, options) {\n    let projectIdList = ['1']\n    let startAtYm = moment().format('YYYYMM')\n    let finishAtYm = moment().format('YYYYMM')\n    //     let commonSqlContent = `\n    // SET NAMES utf8mb4;\n    // SET foreign_key_checks = 0;\n    // `\n    let commonSqlContent = ''\n    for (let tableName of [\n      SINGLE_T_O_PROJECT,\n      SINGLE_T_R_BEHAVIOR_DISTRIBUTION,\n      SINGLE_T_R_DURATION_DISTRIBUTION,\n      SINGLE_T_R_HTTP_ERROR_DISTRIBUTION,\n      SINGLE_T_R_PAGE_VIEW,\n      SINGLE_T_R_SYSTEM_BROWSER,\n      SINGLE_T_R_SYSTEM_RUNTIME_VERSION,\n      SINGLE_T_R_SYSTEM_DEVICE,\n      SINGLE_T_R_SYSTEM_OS,\n      SINGLE_T_R_UNIQUE_VIEW,\n      SINGLE_T_O_ALARM_CONFIG,\n      SINGLE_T_O_USER,\n      SINGLE_T_O_PROJECT_MEMBER,\n      SINGLE_T_O_NEW_USER_SUMMARY,\n      SINGLE_T_R_ALARM_LOG\n    ]) {\n      let content = generate(tableName)\n      await Knex.schema.raw(content)\n      commonSqlContent = `${commonSqlContent}\\n${content}`\n    }\n    let finishAtMoment = moment(finishAtYm, DATE_FORMAT.COMMAND_ARGUMENT_BY_MONTH)\n    let sqlContent = '-- --------分表部分---------'\n    for (let projectId of projectIdList) {\n      for (let currentAtMoment = moment(startAtYm, DATE_FORMAT.COMMAND_ARGUMENT_BY_MONTH);\n        // 生成时间范围之内的数据表\n        currentAtMoment.isBefore(finishAtMoment.clone().add(1, 'months'));\n        currentAtMoment = currentAtMoment.clone().add(1, 'months')) {\n        let curremtAtYM = currentAtMoment.format(SQL_DATE_FORMAT_YM)\n        sqlContent = `${sqlContent}\\n-- SQL for ${curremtAtYM} => \\n`\n        for (let tableName of [\n          MUILT_T_O_MONITOR,\n          MUILT_T_O_MONITOR_EXT,\n          MUILT_T_O_UV_RECORD,\n          MUILT_T_R_CITY_DISTRIBUTION,\n          MUILT_T_R_PERFORMANCE,\n          MUILT_T_O_SYSTEM_COLLECTION,\n          MUILT_T_O_USER_FIRST_LOGIN_AT,\n          MUILT_T_R_ERROR_SUMMARY\n        ]) {\n          let content = generate(tableName, projectId, curremtAtYM)\n          await Knex.schema.raw(content)\n          sqlContent = `${sqlContent}\\n${content}`\n        }\n      }\n    }\n\n    let insertProjectInfo = `\nREPLACE INTO \\`t_o_project\\` (\\`id\\`, \\`rate\\`, \\`display_name\\`, \\`project_name\\`, \\`c_desc\\`, \\`is_delete\\`, \\`create_ucid\\`, \\`update_ucid\\`, \\`create_time\\`, \\`update_time\\`) VALUES (1, 10000, '模板项目', 'template', '负责人:你好', 0, '', '', 0, 0);\n`\n    await Knex.schema.raw(insertProjectInfo)\n    insertProjectInfo += await getSQL()\n    let sql = `${commonSqlContent}\\n${sqlContent}\\n${insertProjectInfo}\\n`\n  }\n\n  /**\n     * 覆盖父类方法, 避免再手工删除冗余日志记录\n     * @param {*} args\n     * @param {*} options\n     */\n  async handle (args, options) {\n    await this.execute(args, options).catch(e => {\n      this.log('catch error')\n      this.log(e.stack)\n    })\n  }\n\n  /**\n     * 覆盖父类方法, 避免再手工删除冗余日志记录\n     * @param {*} args\n     * @param {*} options\n     */\n  async log (message) {\n    console.log(message)\n  }\n}\nexport default GenerateSQL\n"],"file":"template_sql.js"}